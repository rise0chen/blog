---
title: svn自动部署代码
id: 9008
date: 2016-08-30 12:09:22
updated: 2016-08-30 12:09:22
categories: Linux笔记
tags: 版本控制
---

## 1.安装svn服务器
```bash
apt-get install subversion
cd /usr/local/              //进入目录，准备创建svn目录
mkdir svn       //创建一个svn目录
svnadmin create /usr/local/svn/first  //创建一个svn版本仓库first(first可以随便起名字) 
```

## 2.修改三个配置文件 
cd first/conf               //进入first版本仓库下的配置文件目录 

###  (1) svnserve.conf 
anon-access = none       //默认是只读read
auth-access = write      //认证后有写入权限
password-db = passwd     //帐号密码配置文件
authz-db = authz         //权限配置文件
realm = first            //改成自己的版本库 生效范围

### (2) authz 
[group]  
first = ddl,shl       //创建一个first的组，并制定两个用户ddl和shl 
[/]                   //制定根目录下的权限 
@first = rw           //first组用户权限为读写  
* = r                 //其他用户只有读权限 

### (3) passwd
[users] 
ddl = 123456    //用户名 = 密码(明文)

## 3.启动svn服务器
SVN版本库起动方式，现在svn下面有 first、test 两个版本库  
1：单版本库起动    svnserve -d -r /usr/local/svn/first 
2：多版本库起动    svnserve -d -r /usr/local/svn
区别在于起动svn时候的命令中的启动参数-r指定的目录。

其他svn命令：
lsof -i :3690   查看svn是否启动 
ps aux |grep 'svn'  查找所有svn启动的进程 
netstat -anp|grep svnserve查看一下SVN信息

## 4.svn客户端
**checkout：**svn checkout svn://localhost:3690/first .   //注意目录后面还有一个点
**add：**svn add *  //将所有文件上传
**commit：**svn commit -m "message" *  //开始上传

## 5.使用post-commit实现自动部署
在 svn 目录的 /hooks里面有一堆tmpl，这些tmpl可以做很多事情，不过今天我们就说一下自动部署post-commit.tmpl。
**step.1:**
vi post-commit
#!/bin/sh
svn update --username **** --password **** /var/www/test
**step.2:**
修改post-commit的可执行权限
chmod 755 post-commit

## 6.常见错误，我遇到的
255错误：post-commit没有给执行权限 或者 头部没有执行用sh执行，就是没有#!/bin/sh
提示跳过目录：服务器目录没有checkout代码，记得一定要先checkout一次，才能同步(!,每次新建项目都需要）


转自：http://www.cnblogs.com/mitang/p/4309762.html
